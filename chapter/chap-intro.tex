\chapter{绪论}\label{intro}
%借助日益强大的计算机技术，人们把感兴趣的物体离散化为数字模型后，就可以在计算机上对它们做分析和运算。比如，2维的四边形网格和3维的六面体网格在有限元方法中发挥着重要的作用。为了利用对区域的简化更好地生成四边形，本文利用无翻转的映射作为输入区域和简化区域的桥梁。
本章回顾了2维四边形网格的生成及应用，并介绍了无翻转映射这一概念。本文的主要思想是把无翻转的映射作为输入区域和简化区域——多正多边形结构的桥梁，在多正多边形结构上生成四边形网格后，再映回原始区域得到需要的四边形网格。
\section{2维四边形网格生成技术}\label{quad-teche}
\subsection{四边形网格的应用}\label{application}
工程上的许多分析和模拟都归结为在连续的物理系统中求解偏微分方程。比如模拟飞机在不同的气流环境中的飞行表现、计算集成电路中的电场分布、利用波动方程分析油气储集层的地质情况等。由于很多偏微分方程难以找到解析解，人们常常利用计算机模拟这些系统，先在离散化的定义域上建立差分方程模型，再求出满足精度的数值解。为了在这些离散的点组成的平面、曲面或空间中利用点的邻域近似地计算导数，我们需要把这些连续的定义域离散化为网格。图展示了平面和空间中常见的网格模型。

有限元方法是求解不规则区域上的偏微分方程数值解的有力技术。平面和曲面上的区域被离散化为尽量规则的三角形或四边形网格，而空间区域则被离散化为四面体或六面体网格。一般而言，2维区域上的四边形网格比三角形网格具有更高的计算精度和更快的收敛速度。随着计算机的迅猛发展，飞速提升的运算速度使得计算数值解越来越快，但生成复杂区域的高质量四边形网格仍然要花费大量的时间，常常需要进行繁琐而艰辛的用户交互。因此，自动、快速、鲁棒地生成高质量的四边形网格是进行有限元分析的重要前提，。
\subsection{四边形网格的质量}\label{quad-metric}
满足如下条件的四边形网格是有限元方法的良好输入：
\begin{enumerate}
	\item \textbf{没有翻转的四边形:}\,无效的翻转单元会严重影响数值解的精度以及收敛性。我们给出
	\begin{definition}\label{def:invertquad}
		把四边形的顶点按逆时针顺序记为$v_1,v_2,v_3,v_4$,考虑三角形$\triangle v_1v_2v_3,\triangle v_2v_3v_4,\triangle v_3v_4v_1,\triangle v_4v_1v_2$。若它们的有向面积均有至少一个为负，则称四边形是\emph{翻转}的,我们称没有翻转四边形的网格是\emph{有效}网格。图（分4个三角形，翻转）
	\end{definition}
	\item \textbf{接近原始边界:}\,离散化的四边形网格在边界上要和连续的边界曲线尽量接近，否则会导致数值解的误差过大而不能满足需求。
	
	\item \textbf{规则的四边形单元：}\,越接近正方形或矩形的四边形单元越规则，规则的四边形单元会提高有限元方法的计算精度和速度。因此，通过考察四边形单元的角度是否接近直角，我们可以衡量四边形网格的质量好坏。
	\item \textbf{较少的奇异点:}\,
		\begin{definition}\label{singularity}
			四边形网格的内部点中，度为$4$的称为\emph{规则点},度不为$4$的称为\emph{奇异点}。
		\end{definition}
		四边形网格中的奇异点会减慢解方程的速度，并导致数值解的不稳定性，但在一些几何特征(如分叉、凸起)附近的奇异点又能有效地控制网格的扭曲，(ref 06 arm24)中针对具体的应用做了详细解释。因此，生成四边形网格时应避免不必要的奇异点。

\end{enumerate}

一种提高四边形网格质量的方法是保持它的拓扑结构，优化点的位置。为此，人们设计了很多\emph{代数度量}，把四边形的质量表达成点坐标的函数从而进行优化 。显然，这些度量需要是光滑的，具有全局的旋转、平移、伸缩不变性，并且当且仅当四边形为正方形时达到最大，四边形退化时达到最小。常用的代数度量都是基于网格单元与目标单元之间仿射变换的雅可比矩阵来定义的。

首先考虑任意$\triangle v_0v_1v_2$，对应地，记它在网格中的坐标为$\mvar_i,\mvar_i=(x_i,y_i)^T$,它的目标单元的坐标为$\mvar^g_i$,它的参考单元坐标为$\mvar^r_i$,$i=0,1,2$，三者的变换关系见图。\ref{equ:r2g},\ref{equ:r2p},\ref{equ:g2p}式分别给出了参考单元到目标单元,参考单元到网格单元,目标单元到网格单元的变换。
%从参考单元到目标单元的变换见\ref{equ:r2g},参考单元到网格单元的变换见\ref{equ:r2p},目标单元到网格单元的变换见\ref{equ:g2p}。
\begin{equation}\label{equ:r2g}
\mvar=\mA \mvar^r+\mvar_1
\end{equation}
\begin{equation}\label{equ:r2p}
\mvar^g=\mW \mvar^r
\end{equation}
\begin{equation}\label{equ:g2p}
\mvar=\mS \mvar^g+\mvar_1
\end{equation}
容易验证，目标单元到网格单元仿射变换的雅可比矩阵，即$\mS$为
\begin{equation}\label{equ:aff-jacob}
\mS=\mA \mW{^{-1}}
\end{equation}
其中
\begin{equation} \label{equ:affA}
\mA=
\left(
\begin{array}{cc}
x_2-x_1 & x_3-x_1 \\ 
y_2-y_1 & y_3-y_1
\end{array} 
\right)
\end{equation}
$\mS$与参考点的选取无关。若四边形网格以正方形为目标单元,对应的按照\ref{def:invertquad}分成的三角形的目标单元为等腰直角三角形，此时目标单元即为参考单元，即$\mW=\mathbf{I},\mS=\mA$。对于三角形网格，常把目标单元取为正三角形。

我们选用雅可比矩阵$\mS$的条件数作为网格单元质量的度量。即
\begin{equation}\label{equ:Jac-condition}
\kappa(\mvar)=\frac{\|\mS\|_F \cdot \|\mS^{-1}\|_F}{2}
\end{equation}
其中$\|\cdot\|_F$为矩阵的Frobenious范数，分母2为归一化因子。整个网格质量的度量定义为
\begin{equation}\label{equ:mesh-metric}
\left|K_{\kappa}\right|_p(\mvar)=\left[\sum_{m=1}^M(\kappa_m)^p(\mvar)\right]^{\frac{1}{p}}
\end{equation}
\subsection{相关工作}\label{related-work}
由于全自动地生成高质量的四边形网格已经成为工业界的重大需求，近年来研究者们提出了各种各样的网格生成算法。
\begin{enumerate}
	\item \textbf{基于三角网格的转化}：由于高质量的三角网格较容易生成,一个最简单的想法是直接对每个三角形细分得到四边形网格，但这样产生了大量冗余的四边形单元以及奇异点，而且网格质量较差，这种方法通常被用在以四边形为主的网格中。另一类方法的基本思想是把两个有公共边的三角形合并为一个四边形，如Johnston等人[1]Lo和Lee等人[2]的工作。这类方法产生的四边形网格质量虽然高于前者，但仍然会产生较多的奇异点。总之，这类方法由于受到三角网格的点的分布和连接关系的限制，难以产生奇异点较少的高质量四边形网格。
	
	\item \textbf{几何分解}：这类方法先根据输入的2维区域的几何特征把它把分解为简单的凸区域,再进一步把它们四边形化。Chae和Jeong【3】,Talbert和Parkinson[4],Nowottny[5]使用了递归分解的算法。Baehmann等人[5]使用了四叉树分解的算法。Tom和Amstrong[6],David[7]等人利用中轴线结构分解了2维区域。这类算法能在产生较少奇异点的同时生成高质量的全四边形网格，但对于复杂的边界变化较为敏感，过多的算法细节使得算法不够鲁棒且难以自动化。
	
	\item \textbf{前沿推进}：这类方法由边界出发并向内推进，进而产生四边形网格。比如blacker 和stepheson【11】提出了Paving的方法，Kinney[12]做出了改进。这类方法能对边界复杂的区域产生高质量的网格，但在不同方向上推进的单元相遇时可能会发生自交，对网格的有效性没有保证，并且容易在边界附近产生较多的奇异点。
	
	\item \textbf{网格模板法}：这类方法先产生特定的四边形网格模板，再把它应用于目标区域。如Thacker等人[9]首先提出用格点自然形成的正方形网格结构作为目标区域内部的四边形，再对边界附近的正方形单元作出调整以适应不规则的边界。Haber[10]等人忽略接近平角的拐角点，形成逻辑上3、4边的原始区域, 再利用无限映射(transfinite mapping)法把正三角形、正方形上的四边形网格模板映到原始区域上。这类方法能在简单边界的区域产生高质量的网格，因此人们常常先用几何分解方法把复杂区域分解为简单区域，再利用合适的网格模板四边形化。
	
	\item \textbf{由场指导的方法}：这类方法先在区域上产生定向场(orientation field)，再由它指导产生分布接近这个场的四边形网格。它的优势在于场的奇异性直接决定四边形网格的奇异性，这使得我们可以根据想要的四边形网格设计场。Fogg等人【15】根据中轴角设计出区域内的定向场并由此产生了少量孤立的奇异点，Kowalski等人【16】先在产生符合边界几何特征的场，再通过解偏微分方程传播到内部，Sethian等人[16]提出的快速行进(fast marching)算法可以把用户给定的稀疏场传播到整个区域。由场的奇异点出发的追踪
	(tracing)法可以产生合理的分割，得到容易四边形化的简单区域。
\end{enumerate}

\section{计算无翻转映射}\label{invertion-free}
映射和变形在几何处理、形状建模以及动画等领域中是至关重要的。我们首先给出
\begin{definition}\label{def:local-injective}
称映射$f:\mR^d \rightarrow \mR^d$是\textbf{无翻转}的，是指映射的雅克比矩阵$J(f)$的行列式$det(J(f))>0$
\end{definition}
在计算机图形学中，我们常常需要构造连续的分片线性映射，比如网格的变形、表面网格到平面的参数化、网格质量提高等等。这些问题要求映射得到的网格与输入网格具有相同的连接关系，并在无翻转的基础上最小化二者之间的某种几何度量的形变。由于任何真实的材料无法被压缩为零甚至是负的体积或面积，翻转的单元无法通过物理变形而得到，所以无翻转的映射是一个基本而广泛的要求，尽管如此，保证这一点却很困难。

计算任意形体之间的无翻转映射$f$的一个常用方法如下：先设计一个能量方程$E(f)$来度量对映射的某种需要，比如\emph{共形}和\emph{面积}形变，而$f$通常是点坐标$\mvar$的函数，然后在无翻转和其它特定约束下(如变形时用户指定的目标位置，网格质量提高时对边界的固定)计算最小化$E(f)$的目标位置$f(\mvar)$，这是一个非线性带约束的优化问题。受到(ref bv04)的启发，许多工作通过设计一个能量函数，使其在$J(f)$接近0时趋于无穷大，把问题转化为无约束优化，如MIPS能量(Most-Isometric Parameterizations)(ref mips)及其扩展(ref extend mips)，并且致力于提出高效和收敛性好的优化算法。

在本文中有两处需要计算无翻转映射。一是把输入的2维三角网格变形为多正多边形结构的三角网格，这是对原始区域的简化。由于我们要利用变形的映射把多正多边形上生成的四边形网格映回原始区域，若映射含有较多翻转单元，最后会得到质量很差的四边形网格，我们采用了(ref amips,xiaoming)的能量防止翻转。另外一个需要无翻转映射的是四边形网格质量的提高，我们把待提高的网格看作由正方形网格变形得到的结果，然后固定边界，以最小化$J(f)$的条件数为目标计算无翻转映射，即可得到不含翻转单元的高质量四边形网格。


\section{本文的贡献及组织}\label{contri-organ}
基于\ref{quad-metric}节和\ref{related-work}介绍的对2维四边形网格的要求以及相关的工作，我们提出了多正多边形辅助的2维四边形网格生成算法。%它能自动、快速、鲁棒地生成奇异点较少且质量较高的网格。

启发我们的是利用多立方体结构(Polycube)生成六面体网格的算法(ref Gregson, PolyCut,Huang)。他们研究了自动构造多立方体结构的算法，计算出输入四面体网格到多立方体结构之间的映射，再利用多立方体结构自然的垂直特性，打上格点生成立方体网格，最后把它映回原始区域。这样得到的六面体网格内部完全没有奇异点，这限制了六面体网格的质量。本文的主要算法及写作组织如下：

(1)第\ref{chap:polyquad}章计算了由输入的2维三角网格到多正多边形结构之间的无翻转映射;

(2)第\ref{chap:maquad}章利用基于中轴线的分割方法在多正多边形结构上生成四边形网格；

(3)第\ref{chap:mapback}章借助计算的映射，保持网格的拓扑不变，把多正多边形结构上的四边形网格点映回原始区域。%通过四边形网格点在相应三角形的重心坐标把它们映回
(4)第\ref{chap:sus2d}章通过改变点的位置提高了四边形网格的质量。
本文做出了如下的贡献：

(1)\textbf{提出了构造多正N边形结构三角网格的算法($N \geq 3$)} \,输入不同的N以及高斯平滑的核宽度，可以不同程度地简化原始网格，进而控制四边形网格奇异点的多少。%基于几何分割的四边形网格生成算法对复杂边界不够鲁棒,并且它与其他一些算法(如向前推进、三角网格转化)一样仍会产生不必要的奇异点，但用在边界简单的区域上自然能鲁棒快速地产生奇异点更少的四边形网格。

(2)\textbf{完善了基于中轴线的四边形网格生成算法}\,本文提出了把简单区域(定义见\ref{def:prime})全部转化为3、4、5-边界简单区域的算法，并结合(ref m-a quad)和(ref integer)实现了完整的四边形网格化算法。借助多正多边形结构的辅助，我们得到的中轴线对复杂边界不敏感，并且弥补了中轴线结构忽略几何特征的缺陷，对复杂的边界也能鲁棒地生成高质量、奇异点合适的四边形网格。理论上任何对边界敏感的算法(如向前推进法和其他几何分割方法)都可以通过多正多边形结构的辅助得到更好的结果。

(3)\textbf{提高四边形网格质量}\,在(sus2d)的去除翻转单元同时提高网格质量的优化基础上，我们加上优化四边形角度的能量，通过增大它的比重可以得到正交性更好的接近长方形的单元。
